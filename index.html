<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador de Colecciones de Cromos</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#4CAF50">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 8px;
            margin-top: 20px;
            justify-content: center;
        }
        .sticker {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .sticker.collected {
            background-color: #f44336;
        }
        .sticker:hover {
            transform: scale(1.05);
        }
        .info {
            margin-top: 15px;
            text-align: center;
            color: #666;
        }
        .hidden {
            display: none;
        }
        .collections-list {
            margin-top: 20px;
        }
        .collection-item {
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .collection-item:hover {
            background-color: #f9f9f9;
        }
        .collection-name {
            font-weight: bold;
            color: #333;
        }
        .collection-size {
            color: #666;
            font-size: 14px;
        }
        .back-button {
            background-color: #666;
            margin-bottom: 15px;
        }
        .back-button:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Administrador de Colecciones de Cromos</h1>

        <!-- Home - Lista de colecciones y formulario para crear nueva -->
        <div id="home-screen">
            <div class="collections-list">
                <h2>Colecciones disponibles</h2>
                <div id="collections-container"></div>
            </div>

            <div class="form-group">
                <h2>Crear nueva colección</h2>
                <label for="new-collection-name">Nombre de la colección:</label>
                <input type="text" id="new-collection-name" placeholder="Ej: Fútbol 2024" required>
            </div>

            <div class="form-group">
                <label for="new-sticker-count">Cantidad de cromos en la colección:</label>
                <input type="number" id="new-sticker-count" min="1" placeholder="Ej: 50" required>
            </div>

            <button id="create-new-collection">Crear Colección</button>
        </div>

        <!-- Colección activa - Grilla de cromos -->
        <div id="collection-screen" class="hidden">
            <button class="back-button" id="back-to-home">← Volver al inicio</button>
            <h2 id="active-collection-title"></h2>
            <div class="grid-container" id="sticker-grid"></div>
            <div class="info">
                <p>Clickea los cromos para marcarlos como obtenidos (verde → rojo)</p>
                <button id="reset-collection">Reiniciar Colección</button>
            </div>
        </div>
    </div>

    <script>
        // Almacenamiento de colecciones en localStorage
        let collections = JSON.parse(localStorage.getItem('stickersCollections')) || [];

        // Función para guardar colecciones en localStorage
        function saveCollections() {
            localStorage.setItem('stickersCollections', JSON.stringify(collections));
        }

        // Función para renderizar la lista de colecciones en el home
        function renderCollectionsList() {
            const container = document.getElementById('collections-container');
            container.innerHTML = '';

            if (collections.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">No tienes colecciones aún. ¡Crea una nueva!</p>';
                return;
            }

            collections.forEach((collection, index) => {
                const item = document.createElement('div');
                item.className = 'collection-item';
                item.innerHTML = `
                    <span class="collection-name">${collection.name}</span>
                    <span class="collection-size">${collection.count} cromos</span>
                `;

                item.addEventListener('click', () => {
                    loadCollection(index);
                });

                container.appendChild(item);
            });
        }

        // Función para cargar una colección específica
        function loadCollection(index) {
            const collection = collections[index];
            if (!collection) return;

            // Ocultar home y mostrar pantalla de colección
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('collection-screen').classList.remove('hidden');

            // Actualizar título
            document.getElementById('active-collection-title').textContent = collection.name;

            // Limpiar la grilla anterior
            const grid = document.getElementById('sticker-grid');
            grid.innerHTML = '';

            // Crear los cromos
            for (let i = 1; i <= collection.count; i++) {
                const sticker = document.createElement('div');
                sticker.className = 'sticker';
                sticker.textContent = i;

                // Si el cromo ya estaba marcado como obtenido, aplicar estilo rojo
                if (collection.collected && collection.collected.includes(i)) {
                    sticker.classList.add('collected');
                }

                sticker.addEventListener('click', function() {
                    this.classList.toggle('collected');

                    // Actualizar estado en el objeto de colección
                    const collected = collection.collected || [];
                    const stickerNum = parseInt(this.textContent);

                    if (this.classList.contains('collected')) {
                        if (!collected.includes(stickerNum)) {
                            collected.push(stickerNum);
                        }
                    } else {
                        const index = collected.indexOf(stickerNum);
                        if (index > -1) {
                            collected.splice(index, 1);
                        }
                    }

                    collection.collected = collected;
                    saveCollections();
                });

                grid.appendChild(sticker);
            }

            // Guardar el índice de la colección actual
            window.currentCollectionIndex = index;
        }

        // Evento para crear una nueva colección
        document.getElementById('create-new-collection').addEventListener('click', function() {
            const collectionName = document.getElementById('new-collection-name').value.trim();
            const stickerCount = parseInt(document.getElementById('new-sticker-count').value);

            if (!collectionName || isNaN(stickerCount) || stickerCount <= 0) {
                alert('Por favor, ingresa un nombre válido y una cantidad de cromos mayor a 0.');
                return;
            }

            // Verificar si ya existe una colección con ese nombre
            const existing = collections.find(c => c.name === collectionName);
            if (existing) {
                if (!confirm(`Ya existe una colección llamada "${collectionName}". ¿Deseas sobrescribirla?`)) {
                    return;
                }
                // Eliminar la colección existente
                collections = collections.filter(c => c.name !== collectionName);
            }

            // Crear nueva colección
            const newCollection = {
                name: collectionName,
                count: stickerCount,
                collected: []
            };

            collections.push(newCollection);
            saveCollections();

            // Limpiar formularios
            document.getElementById('new-collection-name').value = '';
            document.getElementById('new-sticker-count').value = '';

            // Renderizar lista actualizada
            renderCollectionsList();

            // Mostrar mensaje de éxito
            alert(`Colección "${collectionName}" creada exitosamente!`);
        });

        // Evento para volver al home desde la colección
        document.getElementById('back-to-home').addEventListener('click', function() {
            document.getElementById('collection-screen').classList.add('hidden');
            document.getElementById('home-screen').classList.remove('hidden');
        });

        // Evento para reiniciar colección
        document.getElementById('reset-collection').addEventListener('click', function() {
            const collection = collections[window.currentCollectionIndex];
            if (!collection) return;

            // Reiniciar todos los cromos
            collection.collected = [];
            saveCollections();

            // Actualizar visualmente la grilla
            const stickers = document.querySelectorAll('.sticker');
            stickers.forEach(sticker => {
                sticker.classList.remove('collected');
            });
        });

        // Registrar service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/cromo-coleccion/sw.js').then(function(registration) {
                    console.log('SW registrado:', registration.scope);
                }).catch(function(error) {
                    console.log('SW falló:', error);
                });
            });
        }

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            renderCollectionsList();
        });
    </script>

</body>
</html>
